---
title: "EDS 231: Assignment 2"
author: "Juliet Cohen, Charles Hendrickson,Scout Leonard, Peter Menzies"
date: '`r format(Sys.time(), "%m/%d/%Y")`'
output: pdf_document
header-includes:
  - \setlength{\parindent}{1em}
  - \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(jsonlite)  
library(tidyverse) 
library(tidytext) 
library(here)

requery <- TRUE
```

# Download Data

## SL-1 Accident data

```{r}
if (requery == TRUE) 
  {
    term <- "nuclear+energy" # Need to use + to string together separate words
    begin_date <- "19601203"
    end_date <- "19610203"
    
    #construct the query url using API operators
    baseurl <- paste0("http://api.nytimes.com/svc/search/v2/articlesearch.json?q=",
                      term,
                      "&begin_date=",
                      begin_date,
                      "&end_date=",
                      end_date,
                      "&",
                      "&facet_filter=true&api-key=",
                      "cqRVqR7OxTbIN7WkN9GJ3DgGsEbMI2cR",
                      sep = "") 
    
    
    initialQuery <- fromJSON(baseurl)
    
    maxPages <- round((initialQuery$response$meta$hits[1] / 10) - 1) 
    
    pages <- list()
    for (i in 0:maxPages) 
      {
        nytSearch <- fromJSON(paste0(baseurl, 
                                     "&page=",
                                     i), 
                              flatten = TRUE) %>%
          data.frame() 
        
        message("Retrieving page ", i)
        
        pages[[i+1]] <- nytSearch 
        
        Sys.sleep(6) 
    }
    
    class(nytSearch)
    
    df <- rbind_pages(pages)
  
    saveRDS(df, here("data", "nyt_nuclear_energy_sl1.RDS"))
}

sl1_df <- readRDS(here("data", "nyt_nuclear_energy_sl1.RDS"))
```

## Three Mile Island Accident data

```{r}
if (requery == TRUE) 
  {
    term <- "nuclear+energy" # Need to use + to string together separate words
    begin_date <- "19780228"
    end_date <- "19780428"
    
    #construct the query url using API operators
    baseurl <- paste0("http://api.nytimes.com/svc/search/v2/articlesearch.json?q=",
                      term,
                      "&begin_date=",
                      begin_date,
                      "&end_date=",
                      end_date,
                      "&",
                      "&facet_filter=true&api-key=",
                      "cqRVqR7OxTbIN7WkN9GJ3DgGsEbMI2cR",
                      sep = "") 
    
    
    initialQuery <- fromJSON(baseurl)
    
    maxPages <- round((initialQuery$response$meta$hits[1] / 10) - 1) 
    
    pages <- list()
    for (i in 0:maxPages) 
      {
        nytSearch <- fromJSON(paste0(baseurl, 
                                     "&page=",
                                     i), 
                              flatten = TRUE) %>%
          data.frame() 
        
        message("Retrieving page ", i)
        
        pages[[i+1]] <- nytSearch 
        
        Sys.sleep(6) 
    }
    
    class(nytSearch)
    
    df <- rbind_pages(pages)
  
    saveRDS(df, here("data", "nyt_nuclear_energy_threemile.RDS"))
}

threemile_df <- readRDS(here("data", "nyt_nuclear_energy_threemile.RDS"))
```

## Chernobyl disaster data

## Fukashima disaster data
